(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{365:function(s,e,a){s.exports=a.p+"assets/img/efs-console-view.69058a7e.png"},514:function(s,e,a){"use strict";a.r(e);var t=a(40),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"amazon-efs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#amazon-efs"}},[s._v("#")]),s._v(" Amazon EFS")]),s._v(" "),t("ul",[t("li",[s._v("Amazon Elastic File System(Amazon EFS)은 AWS 클라우드 서비스와 온프레미스 리소스에서 사용할 수 있는 간단하고 확장 가능하며 탄력적인 완전 관리형 탄력적 NFS 파일 시스템을 제공")]),s._v(" "),t("li",[s._v("Amazon EKS에서 Container Volume으로 활용"),t("br"),s._v(" "),t("a",{attrs:{href:"https://docs.aws.amazon.com/ko_kr/efs/latest/ug/whatisefs.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.aws.amazon.com/ko_kr/efs/latest/ug/whatisefs.html"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"deploy-efs-csi-driver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploy-efs-csi-driver"}},[s._v("#")]),s._v(" Deploy EFS CSI Driver")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("EFS Container Storage Interface")])]),s._v(" "),t("li",[t("p",[s._v("Kubernetes 클러스터가 Amazon EFS 파일 시스템의 수명 주기를 관리할 수 있도록 CSI 인터페이스를 제공")])]),s._v(" "),t("li",[t("p",[s._v("Persistent Volume 에 Amazon EFS 를 활용하기 위하여 배포")])]),s._v(" "),t("li",[t("p",[s._v("CSI Driver Deploy Manual"),t("br"),s._v(" "),t("a",{attrs:{href:"https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/efs-csi.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/efs-csi.html"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("배포 내역")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ kubectl get ds -n kube-system | grep efs\nefs-csi-node   2         2         2       2            2           kubernetes.io/arch=amd64,kubernetes.io/os=linux   3h21m\n\n$ kubectl get po -n kube-system | grep efs\nefs-csi-node-9trv2                              3/3     Running   0          3h21m\nefs-csi-node-g46d5                              3/3     Running   0          3h21m\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("EBS CSI Driver Github Repository 참조"),t("br"),s._v(" "),t("a",{attrs:{href:"https://github.com/kubernetes-sigs/aws-efs-csi-driver",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/kubernetes-sigs/aws-efs-csi-driver"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"create-volume-on-container"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-volume-on-container"}},[s._v("#")]),s._v(" Create Volume on Container")]),s._v(" "),t("ul",[t("li",[s._v("StorageClass YAML 설정 및 생성")])]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <sc name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" efs.csi.aws.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("AWS Console 에서 작업")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("NFS (port 2049) Inbound Traffic 을 허용하는 Security Group 생성하여, EKS Cluster VPC 에 적용")])]),s._v(" "),t("li",[t("p",[s._v("Amazon EFS File System 을, EKS Cluster VPC 에 생성")])]),s._v(" "),t("li",[t("p",[s._v("EFS File System 생성 확인"),t("br"),s._v(" "),t("img",{attrs:{src:a(365),alt:""}})])])]),s._v(" "),t("p",[t("small",[s._v("NOTE : "),t("em",[s._v("Amazon EFS 액세스 포인트 생성 참조")]),s._v(" "),t("br"),s._v(" "),t("a",{attrs:{href:"https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/efs-csi.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/efs-csi.html"),t("OutboundLink")],1)])])])]),s._v(" "),t("hr"),s._v(" "),t("ul",[t("li",[s._v("PersistentVolumeClaim YAML 설정 및 생성\n"),t("ul",[t("li",[s._v("accessMode는 ReadWriteMany로 지정")]),s._v(" "),t("li",[s._v("NFS 기반 File Storage에서 ReadWriteMany 를 지원함"),t("br"),s._v(" "),t("a",{attrs:{href:"https://kubernetes.io/ko/docs/concepts/storage/persistent-volumes/#%EC%A0%91%EA%B7%BC-%EB%AA%A8%EB%93%9C",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kubernetes.io/ko/docs/concepts/storage/persistent-volumes/#접근-모드"),t("OutboundLink")],1)])])])]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <pvc name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <namespace name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <sc name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <request size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("PersistentVolume YAML 설정 및 생성\n"),t("ul",[t("li",[s._v("persistentVolumeReclaimPolicy를 Retain으로 설정하여, PV 가 삭제되더라도 EFS File System 이 자동 삭제되지 않도록 함")]),s._v(" "),t("li",[s._v("csi.volumeHandle 에 EFS File System 의 ID 지정 필요")])])])]),s._v(" "),t("div",{staticClass:"language-yml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolume\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <pv name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capacity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <capacity size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Filesystem\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeReclaimPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Retain\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <sc name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("csi")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" efs.csi.aws.com\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeHandle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" <EFS File System ID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ul",[t("li",[s._v("pvc / pv 생성 확인")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ kubectl get pvc -n session-dev | grep agent\nngrinder-agent        Bound    ngrinder-agent                             2Gi        RWX            efs-sc         3h25m\n\n$ kubectl get pv -n session-dev | grep agent\nngrinder-agent                             2Gi        RWX            Retain           Bound    session-dev/ngrinder-agent           efs-sc                  3h25m\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);